
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="icon" type="image/ico" href="images/favicon.ico">
    <title>Developers</title>

    <script type="text/javascript" src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@4"></script>
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
    });
    </script>
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>

    <style media="screen">
      /* Add space between vega-embed links */
      /* http://vega.github.io/vega-tutorials/airports/ */
      .vega-embed .vega-actions a {
        margin-left: 1em;
        visibility: hidden;
      }
      .vega-embed:hover .vega-actions a {
        visibility: visible;
      }
    </style>
  </head>

  <body class="developers" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <a href="https://gunrock.github.io/">
        <img src="images/logo.png" class="logo" alt="Logo" />
      </a>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc" class="toc-list-h1">
          <li>
            <a href="#developers" class="toc-h1 toc-link" data-title="Developers">DEVELOPERS</a>
          </li>
          <li>
            <a href="#directory-structure" class="toc-h1 toc-link" data-title="Directory Structure">DIRECTORY STRUCTURE</a>
          </li>
          <li>
            <a href="#git-forking-workflow" class="toc-h1 toc-link" data-title="Git Forking Workflow">GIT FORKING WORKFLOW</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#how-forking-workflow-works" class="toc-h2 toc-link" data-title="How Forking Workflow Works?">How Forking Workflow Works?</a>
                  </li>
                  <li>
                    <a href="#gunrock-39-s-forking-workflow" class="toc-h2 toc-link" data-title="Gunrock's Forking Workflow">Gunrock's Forking Workflow</a>
                  </li>
                  <li>
                    <a href="#how-to-contribute" class="toc-h2 toc-link" data-title="How to contribute?">How to contribute?</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#googletest-for-gunrock" class="toc-h1 toc-link" data-title="GoogleTest for Gunrock">GOOGLETEST FOR GUNROCK</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#example-test-using-googletest" class="toc-h2 toc-link" data-title="Example Test Using GoogleTest">Example Test Using GoogleTest</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#from-gunrock-to-json" class="toc-h1 toc-link" data-title="From Gunrock to JSON">FROM GUNROCK TO JSON</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#how-do-we-export-information-from-gunrock" class="toc-h2 toc-link" data-title="How do we export information from Gunrock?">How do we export information from Gunrock?</a>
                  </li>
                  <li>
                    <a href="#fields-that-should-be-in-any-gunrock-run" class="toc-h2 toc-link" data-title="Fields that should be in any Gunrock run">Fields that should be in any Gunrock run</a>
                  </li>
                  <li>
                    <a href="#fields-for-any-traversal-based-primitive" class="toc-h2 toc-link" data-title="Fields for any traversal-based primitive">Fields for any traversal-based primitive</a>
                  </li>
                  <li>
                    <a href="#bfs-specific-fields" class="toc-h2 toc-link" data-title="BFS-specific fields">BFS-specific fields</a>
                  </li>
                  <li>
                    <a href="#thread-safety-quot-using-json-spirit-with-multiple-threads-quot" class="toc-h2 toc-link" data-title="Thread safety: "Using JSON Spirit with Multiple Threads"">Thread safety: "Using JSON Spirit with Multiple Threads"</a>
                  </li>
                  <li>
                    <a href="#if-compilation-is-too-slow" class="toc-h2 toc-link" data-title="If compilation is too slow">If compilation is too slow</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#setup-and-use-gunrock-io" class="toc-h1 toc-link" data-title="Setup and Use gunrock/io">SETUP AND USE GUNROCK/IO</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#how-to-use-gunrock-io" class="toc-h2 toc-link" data-title="How to use gunrock/io">How to use gunrock/io</a>
                  </li>
              </ul>
          </li>
      </div>
        <ul class="toc-footer">
            <li><a href='https://github.com/gunrock/gunrock'>Gunrock; GPU Graph Analytics</a></li>
            <li>Gunrock Â© 2019 The Regents of the University of California.</li>
        </ul>
    </div>
    <div class="page-wrapper">

        <div class="dark-box"></div>

      <div class="content">
        <h1 id='developers'>Developers</h1>
<p>This is a developer's guide for Gunrock, split into three major sections based on the depth of the work:</p>

<ul>
<li>Interface Developer's Guide</li>
<li>Primitive/Application/Algorithm Developer's Guide</li>
<li>Operator/Core Developer's Guide</li>
</ul>
<h1 id='directory-structure'>Directory Structure</h1>
<p>Regardless of the level of contribution you would like to make, or develop towards, it is essential to understand the source directory structure of Gunrock. Knowing where things are will help decide the best place to invest your time in, and make the changes needed for your particular problem.</p>

<p>[gunrock's root]
  - <strong>.github</strong> --
  GitHub related files and folders, such as issue and pull request templates can be found here.</p>

<ul>
<li><p><strong>cmake</strong> --
CMake modules are located here, allowing us to download googletest source code on the fly during cmake build, and other modules to look for the respective libraries and prerequisites.</p></li>
<li><p><strong>dataset</strong> --
Important gunrock datasets used in the publications, performance testing, correctness checking and unit tests are located here.</p>

<ul>
<li><strong>large</strong> --
Large datasets are not stored in the github repository, we instead provide a Makefile to download the required dataset (or the entire collection) by simply running <code>make</code> in the respective subdirectory (or large directory for the whole collection).

<ul>
<li>[dataset]</li>
</ul></li>
<li><strong>small</strong> --
Generally less than a 100 nodes (or a few 100s of nodes), these datasets are good candidates for correctness checking and quick tests. If you are developing a primitive within gunrock, it is recommended to use these for testing purposes and conduct a much more comprehensive tests/correctness check using the dataset under <code>large</code> directory.</li>
</ul></li>
<li><p><strong>docker</strong> --
Docker files for different configurations, simply run <code>docker build . -t gunrock</code> in one of the subdirectories, and start the docker session using <code>nvidia-docker run -it gunrock /bin/bash</code>.</p></li>
<li><p><strong>docs</strong> --
Documentation repository (https://github.com/gunrock/docs) used for the main gunrock's website available at https://gunrock.github.io/docs/</p></li>
<li><p><strong>doxygen</strong> --
Doxygen generated API docs.</p></li>
<li><p><strong>examples</strong> --
Application test driver are located here in the subdirectory of the respective application. The <code>main()</code> function in each <code>test_<app>.cu</code> file in the subdirectories is responsible for setting the templated types and calling the CPU reference implementation as well as the Gunrock GPU implementation for the respective application.</p>

<ul>
<li>[example application]</li>
</ul></li>
<li><p><strong>externals</strong> --
External modules used by gunrock, perform <code>git submodule init &amp;&amp; git submodule update</code> to fetch the modules; these include moderngpu, CUB and rapidJSON.</p></li>
<li><p><strong>gunrock</strong> --
Core of gunrock's source code is located here, this includes implementation of different algorithms/primitives, graph data structure, graph loader, operators, partitioner, other useful utlities, etc.</p>

<ul>
<li><p><strong>app</strong> --
Implementations of each applications are located here (the driver is located under [root]/examples/[application name]).</p>

<ul>
<li><strong>hello</strong> --
A sample application used to guide developers through writing their own application within gunrock.</li>
<li>hello_app.cu : High level view of the application, used to call the problem initialization and reset, enactor initialization and reset, and the validation routine. The external c-interface for the respective application is also located within the <code><app_name>_app.cu</code> file.</li>
<li>hello_test.cuh : CPU reference code, validation routine and a display/output function are all located in the <code><app_name>_test.cuh</code> file. Mainly used for correctness checking of the parallel implementation within gunrock and gunrock's programming model.</li>
<li>hello_problem.cuh : An application's data goes here. Declaration, initialization, reset and extraction of the data happens in the <code><app_name>_problem.cuh</code> file.</li>
<li>hello_enactor.cuh : Iteration loop, operators and the actual algorithm implementation goes in the <code><app_name>_enactor.cuh</code> file.</li>
</ul></li>
<li><p><strong>graph</strong> --
Supported graph data structures and their helper functions can be found here. An example of such data structure is the Compressed Sparse Row format (CSR), and an example of a helper function for CSR format will be <code>GetNeighborListLength()</code>, which returns the number of neighbors for a given node.</p></li>
<li><p><strong>graphio</strong> --
Graph loader, labels loader, matrix market reader, randomly generated graphs (rgg) generator, etc.</p></li>
<li><p><strong>oprtr</strong> --
Gunrock's operators, such as advance (visiting neighbors), filter (removing nodes), for, neighborreduce, intersection are all located here in their respective folders. Load-balancing for these operators are also done within this directory as part of the operator kernels. See <code>oprtr_parameters.cuh</code> for the available parameters for the operators, and <code>oprtr.cuh</code> for the API for these operators.</p></li>
<li><p><strong>partitioner</strong> --
Graph partitioners such as metis, random, biased random partitioner are located here.</p></li>
<li><p><strong>util</strong> --
Extensive list of supporting utilities for gunrock. Device intrinsic primitives, array utilities, scan, reduction, and a lot more!</p></li>
</ul></li>
<li><p><strong>python</strong> --
Simple Python bindings to the application's C Interfaces are located here as examples that can be built on. Feel free to create a python interface for an application that you would need.</p></li>
<li><p><strong>scripts</strong> --
Scripts for published papers, presentations and a for general performance testing are all located in the subdirectories.</p></li>
<li><p><strong>tools</strong> --
Useful scripts and tools to convert other graph file formats, such as snap or gr to matrix market format (mtx).</p></li>
<li><p><strong>unittests</strong> --
Googletest based unit testing framework for gunrock.</p>

<ul>
<li>[unittest]</li>
</ul></li>
</ul>
<h1 id='git-forking-workflow'>Git Forking Workflow</h1>
<p>Transitioning over from <a href="http://nvie.com/posts/a-successful-git-branching-model/">Git Branching Workflow</a> suggested by Vincent Driessen at nvie to <a href="https://www.atlassian.com/git/tutorials/comparing-workflows#forking-workflow">Git Forking Workflow</a> for Gunrock.</p>
<h2 id='how-forking-workflow-works'>How Forking Workflow Works?</h2>
<p><img src="https://wac-cdn.atlassian.com/dam/jcr:5c0941ff-a8b5-435b-a092-2167705f1e97/01.svg?cdnVersion=hp" alt="Forking Workflow" />
As in the other Git workflows, the Forking Workflow begins with an <strong>official public repository</strong> stored on a server. But when a new developer wants to start working on the project, they do not directly clone the official repository.
<br><br>Instead, they <strong>fork the official repository</strong> to create a copy of it on the server. This new copy serves as their personal public repositoryâno other developers are allowed to push to it, but they can <strong>pull changes</strong> from it (weâll see why this is important in a moment). After they have created their server-side copy, the developer performs a git clone to get a copy of it onto their local machine. This serves as their private development environment, just like in the other workflows.
<br><br> When they're ready to publish a local commit, they push the commit to their own public repositoryânot the official one. Then, they file a pull request with the main repository, which lets the project maintainer know that an update is ready to be integrated. The <strong>pull request also serves as a convenient discussion thread</strong> if there are issues with the contributed code.
<br><br> To integrate the feature into the official codebase, the maintainer pulls the contributorâs changes into their local repository, checks to make sure it doesnât break the project, merges it into his local master branch, then pushes the master branch to the official repository on the server. The contribution is now part of the project, and other developers should pull from the official repository to synchronize their local repositories.</p>
<h2 id='gunrock-39-s-forking-workflow'>Gunrock's Forking Workflow</h2>
<p><strong>gunrock/gunrock:</strong></p>

<ul>
<li><strong>Master Branch:</strong> Reserved only for final releases or some bug fixes/patched codes.</li>
<li><strong>Dev Branch:</strong> Current working branch where all developers push their changes to. This dev branch will serve as the "next release" gunrock, eliminating the need of managing individual branches for each feature and merging them when it is time for the release.</li>
</ul>

<p><strong>(personal-fork)/gunrock</strong></p>

<ul>
<li><strong>Feature Branch:</strong> This is the developer's personal repository with their feature branch. Whatever changes they would like to contribute to gunrock must be in their own personal fork. And once it is time to create a pull request, it is done so using github pull request, a reviewer checks it and the changes are merged into gunrock/gunrock dev branch.</li>
</ul>

<p>Note that transitioning to this type of workflow from branching model doesn't require much effort, we will just have to start working on our forks and start creating pull requests to one dev branch.</p>
<h2 id='how-to-contribute'>How to contribute?</h2>
<ul>
<li>Fork using GitHub; https://github.com/gunrock/gunrock</li>
<li><code>git clone --recursive https://github.com/gunrock/gunrock.git</code></li>
<li><code>git remote set-url --push origin https://github.com/username/gunrock.git</code> This insures that you are pulling from <code>gunrock/gunrock</code> (staying updated with the main repository) but pushing to your own fork <code>username/gunrock</code>.</li>
<li><code>git add <filename></code></li>
<li><code>git commit -m "Describe your changes."</code></li>
<li><code>git push</code></li>
<li>Once you've pushed the changes on your fork, you can create a <strong>pull request</strong> on Github to merge the changes.</li>
<li>Pull request will then be reviewed and merged into the <code>dev</code> branch.</li>
</ul>
<h1 id='googletest-for-gunrock'>GoogleTest for Gunrock</h1>
<p><strong>Recommended Read:</strong> <a href="https://github.com/google/googletest/blob/master/googletest/docs/Primer.md">Introduction: Why Google C++ Testing Framework?</a></p>

<p>When writing a good test, we would like to cover all possible functions (or execute all code lines),
what I will recommend to do is write a simple test, run code coverage on it, and
use codecov.io to determine what lines are not executed. This gives you a good
idea of what needs to be in the test and what you are missing.</p>

<p><strong>What is code coverage?</strong></p>

<blockquote>
<p>Code coverage is a measurement used to express which lines of code were executed by a test suite. We use three primary terms to describe each lines executed.</p>

<ul>
<li>hit indicates that the source code was executed by the test suite.</li>
<li>partial indicates that the source code was not fully executed by the test suite; there are remaining branches that were not executed.</li>
<li>miss indicates that the source code was not executed by the test suite.</li>
</ul>

<p>Coverage is the ratio of hits / (hit + partial + miss). A code base that has 5 lines executed by tests out of 12 total lines will receive a coverage ratio of 41% (rounding down).</p>
</blockquote>

<p>Below is an example of what lines are a hit and a miss; you can target the lines missed in the tests to improve coverage.</p>

<p><img src="https://i.imgur.com/5QwKjcB.png" alt="Example CodeCov Stats" /></p>
<h2 id='example-test-using-googletest'>Example Test Using GoogleTest</h2><pre class="highlight c tab-c"><code><span class="cm">/**
 * @brief BFS test for shared library advanced interface
 * @file test_lib_bfs.h
 */</span>

<span class="c1">// Includes required for the test
</span>
<span class="cp">#include "stdio.h"
#include "gunrock/gunrock.h"
#include "gmock/gmock.h"
#include "gtest/gtest.h"
</span>
<span class="c1">// Add to gunrock's namespace
</span><span class="n">namespace</span> <span class="n">gunrock</span> <span class="p">{</span>

<span class="cm">/* Test function, test suite in this case is
 * sharedlibrary and the test itself is breadthfirstsearch
 */</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">sharedlibrary</span><span class="p">,</span> <span class="n">breadthfirstsearch</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">GRTypes</span> <span class="n">data_t</span><span class="p">;</span>                 <span class="c1">// data type structure
</span>    <span class="n">data_t</span><span class="p">.</span><span class="n">VTXID_TYPE</span> <span class="o">=</span> <span class="n">VTXID_INT</span><span class="p">;</span>         <span class="c1">// vertex identifier
</span>    <span class="n">data_t</span><span class="p">.</span><span class="n">SIZET_TYPE</span> <span class="o">=</span> <span class="n">SIZET_INT</span><span class="p">;</span>         <span class="c1">// graph size type
</span>    <span class="n">data_t</span><span class="p">.</span><span class="n">VALUE_TYPE</span> <span class="o">=</span> <span class="n">VALUE_INT</span><span class="p">;</span>         <span class="c1">// attributes type
</span>    <span class="kt">int</span> <span class="n">srcs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">};</span>

    <span class="k">struct</span> <span class="n">GRSetup</span> <span class="o">*</span><span class="n">config</span> <span class="o">=</span> <span class="n">InitSetup</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">srcs</span><span class="p">);</span>   <span class="c1">// gunrock configurations
</span>
    <span class="kt">int</span> <span class="n">num_nodes</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="n">num_edges</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>  <span class="c1">// number of nodes and edges
</span>    <span class="kt">int</span> <span class="n">row_offsets</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>  <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">};</span>
    <span class="kt">int</span> <span class="n">col_indices</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">};</span>

    <span class="k">struct</span> <span class="n">GRGraph</span> <span class="o">*</span><span class="n">grapho</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">GRGraph</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">GRGraph</span><span class="p">));</span>
    <span class="k">struct</span> <span class="n">GRGraph</span> <span class="o">*</span><span class="n">graphi</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">GRGraph</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">GRGraph</span><span class="p">));</span>
    <span class="n">graphi</span><span class="o">-></span><span class="n">num_nodes</span>   <span class="o">=</span> <span class="n">num_nodes</span><span class="p">;</span>
    <span class="n">graphi</span><span class="o">-></span><span class="n">num_edges</span>   <span class="o">=</span> <span class="n">num_edges</span><span class="p">;</span>
    <span class="n">graphi</span><span class="o">-></span><span class="n">row_offsets</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">row_offsets</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">graphi</span><span class="o">-></span><span class="n">col_indices</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">col_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

    <span class="n">gunrock_bfs</span><span class="p">(</span><span class="n">grapho</span><span class="p">,</span> <span class="n">graphi</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">data_t</span><span class="p">);</span>

    <span class="kt">int</span> <span class="o">*</span><span class="n">labels</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">*</span> <span class="n">graphi</span><span class="o">-></span><span class="n">num_nodes</span><span class="p">);</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">grapho</span><span class="o">-></span><span class="n">node_value1</span><span class="p">;</span>

    <span class="c1">// IMPORTANT: Expected output is stored in an array to compare against determining if the test passed or failed
</span>    <span class="kt">int</span> <span class="n">result</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">2147483647</span><span class="p">,</span> <span class="mi">2147483647</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">};</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o"><</span> <span class="n">graphi</span><span class="o">-></span><span class="n">num_nodes</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// IMPORTANT: Compare expected result with the generated labels
</span>      <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o"><<</span> <span class="s">"Vectors x and y differ at index "</span> <span class="o"><<</span> <span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">graphi</span><span class="p">)</span> <span class="n">free</span><span class="p">(</span><span class="n">graphi</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">grapho</span><span class="p">)</span> <span class="n">free</span><span class="p">(</span><span class="n">grapho</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="n">free</span><span class="p">(</span><span class="n">labels</span><span class="p">);</span>

<span class="p">}</span>
<span class="p">}</span> <span class="c1">// namespace gunrock
</span></code></pre>
<ol>
<li><p>Create a <code>test_<test-name>.h</code> file and place it in the appropriate directory inside <code>/path/to/gunrock/tests/</code>. I will be using <code>test_bfs_lib.h</code> as an example.</p></li>
<li><p>In the <code>tests/test.cpp</code> file, add your test file as an include: <code>#include "bfs/test_lib_bfs.h"</code>.</p></li>
<li><p>In your <code>test_<test-name>.h</code> file, create a <code>TEST()</code> function, which takes two parameters: <code>TEST(<nameofthesuite>, <nameofthetest>)</code>.</p></li>
<li><p>Use <code>EXPECT</code> and <code>ASSERT</code> to write the actual test itself. I have provided a commented example below:</p></li>
<li><p>Now when you run the binary called <code>unit_test</code>, it will automatically run your test suite along with all other google tests as well.
This binary it automatically compiled when gunrock is built, and is found in <code>/path/to/builddir/bin/unit_test</code>.</p></li>
</ol>

<p><strong>Final Remarks:</strong></p>

<ul>
<li>I highly recommend reading the Primer document mentioned at the start of this tutorial. It explains in detail how to write a unit test using google test. My tutorial has more been about how to incorporate it into Gunrock.</li>
<li>Another interesting read is <a href="https://testing.googleblog.com/2014/07/measuring-coverage-at-google.html">Measuring Coverage at Google</a>.</li>
</ul>
<h1 id='from-gunrock-to-json'>From Gunrock to JSON</h1><h2 id='how-do-we-export-information-from-gunrock'>How do we export information from Gunrock?</h2>
<p>Typical programs use "printf" to emit a bunch of unstructured information. As the program gets more sophisticated, "printf" is augmented with command-line switches, perhaps a configuration file, but it's hard to easily parse random printf output.</p>

<p>More structured is JSON format. JSON is a nested dict (hash) data structure with arbitrary keys (and arbitrary nesting). It can be used to hold scalar, vector, and key-value data. Many tools can input and output JSON. It is a good choice for exporting information from a Gunrock program.</p>

<p>Ideally, we would declare a C++ struct or class and simply print it to stdout. The particular issue with C++, however, is that it poorly supports introspection: a running C++ executable does not know anything about the internals of the program that created it. Specifically, it doesn't know its own variable names, at least not without an incredible amount of pain. Maintaining a set of strings that map to variable names is undesirable since that can get out of sync.</p>

<p>Instead, we've elected to use a dict data structure that stores the JSON data, and we will write directly into it. We are using a <a href="http://www.codeproject.com/Articles/20027/JSON-Spirit-A-C-JSON-Parser-Generator-Implemented">header-only JSON generator</a> based on Boost Spirit. It's used like this:</p>

<p>json_spirit::mObject info;
    info["engine"] = "Gunrock";</p>

<p>Currently we can output JSON data in one of three ways, controlled from the command line:</p>

<ul>
<li><code>--json</code> writes the JSON structure to stdout.</li>
<li><code>--jsonfile=filename</code> writes the JSON structure to <em>filename</em>.</li>
<li><code>--jsondir=dir</code> writes the JSON structure to an automatically-uniquely-named file in the <em>dir</em> directory. This is the preferred option, since presumably there is a single directory where all JSON output is stored, and all Gunrock runs can use the same <code>--jsondir=dir</code> command-line option.</li>
</ul>

<p>The current "automatically-uniquely-named file" producer creates <code>name_dataset_time.json</code>. By design, the file name should not matter, so long as it is unique (and thus doesn't stomp on other files in the same directory when it's written). <em>No program or person should rely on the contents of file names.</em></p>

<p>The current JSON structure (<code>info</code>) is passed by reference between various routines. Yuechao suggests that putting <code>info</code> into the global <code>Test_Parameter</code> is a better idea, where it can be passed into the enactor's and problem's <code>Init()</code> routines.</p>

<p>We don't have a fixed schema (yet), so what's below reflects what we put into the test_bfs code. Some of these are likely not useful for any analysis, but it's preferable to include too much info in the JSON output rather than not enough.</p>
<h2 id='fields-that-should-be-in-any-gunrock-run'>Fields that should be in any Gunrock run</h2>
<ul>
<li><em>avg_duty</em>. Average kernel running duty, calculated by kernel run time / kernel lifetime.</li>
<li><em>command_line</em>. Reflects how the program was run. Use <code>args.GetEntireCommandLine()</code>.</li>
<li><em>dataset</em>. Short name of dataset, likely the stem of <code>foo.mtx</code> (in this case, <code>foo</code>). Examples: <code>ak2010</code> or <code>soc_liveJournal1</code>. Important to standardize dataset names to allow joins when compiling stats.</li>
<li><em>elapsed</em>. Elapsed runtime, e.g., <code>0.25508800148963928</code>. Measured in ms.</li>
<li><em>engine</em>. <code>Gunrock</code> for Gunrock runs.</li>
<li><p><em>git_commit_sha1</em>. The git commit identifier, e.g., <code>6f775b82359c3c8529b8878cdae80e9dfbaf5330</code>. (Strategy from <a href="http://stackoverflow.com/questions/1435953/how-can-i-pass-git-sha1-to-compiler-as-definition-using-cmake">StackOverflow</a>, of course.) Settable by</p>

<p>#include <gunrock/util/gitsha1.h>
    info["git_commit_sha1"] = g_GIT_SHA1;</p></li>
<li><p><em>gpuinfo</em>. What GPU did we use? Use:</p>

<p>#include <gunrock/util/sysinfo.h>
    Gpuinfo gpuinfo;
    info["gpuinfo"] = gpuinfo.getGpuinfo();</p></li>
<li><p><em>gunrock_version</em>. Reflects what's set in the top-level CMakeFiles; set as a constant "#define" using a compiler flag <code>-D</code> during compilation. (Since <em>gunrock_version</em> should not change often, this "#define" is acceptable; we only need rebuild when we update the version.) Example: <code>0.1.0</code>.</p>

<p>#define STR(x) #x
    #define XSTR(x) STR(x)
    info["gunrock_version"] = XSTR(GUNROCKVERSION);</p></li>
<li><p><em>iterations</em>. The number of times we run the test, with runtime averaged over all runs. Yuduo suggests considering better names, e.g.:</p>

<ul>
<li><em>search_depth</em>. number of BSP super-steps</li>
<li><em>max_iter</em>. Maximum allowed BSP super-steps, breaking after reaching this value</li>
<li><em>iterations</em>. Number of runs of a primitive</li>
</ul></li>
<li><p><em>mark_predecessors</em>. Set by command-line flag; true or false. Can be set for any primitive, as long as when a primitive does advance, it keeps track of predecessors.</p></li>
<li><p><em>name</em>. Name of primitive; I reused the <code>Stats</code> name <code>GPU BFS</code>. <code>BFS</code> is probably more appropriate. We definitely need canonical names here.</p></li>
<li><p><em>num_gpus</em>. Integer. I think this only works with 1 now. We'll extend to multi-GPU later.</p></li>
<li><p><em>quick</em>: Set by command-line flag; true or false. I don't know what this is.</p></li>
<li><p><em>sysinfo</em>. What GPU/system did we use? Use:</p>

<p>#include <gunrock/util/sysinfo.h>
    Sysinfo sysinfo;
    info["sysinfo"] = sysinfo.getSysinfo();</p></li>
<li><p><em>time</em>. When the test was run. This is a standard format from <code>ctime()</code>, e.g. <code>Wed Jul 22 09:04:05 2015\n</code>. (Oddly, the <code>\n</code> is part of the format.)</p>

<p>time_t now = time(NULL);
    info["time"] = ctime(&amp;now);</p></li>
<li><p><em>userinfo</em>. Who ran this test? Use:</p>

<p>#include <gunrock/util/sysinfo.h>
    Userinfo userinfo;
    info["userinfo"] = userinfo.getUserinfo();</p></li>
<li><p><em>verbose</em>: Set by command-line flag; true or false. Presumably relates to logging output.</p></li>
</ul>
<h2 id='fields-for-any-traversal-based-primitive'>Fields for any traversal-based primitive</h2>
<ul>
<li><em>edges_visited</em>. Self-explanatory.</li>
<li><em>m_temps</em>. Millions of edge-traversals per second, e.g., <code>0.40378222181564849</code>.</li>
<li><em>nodes_visited</em>. Self-explanatory.</li>
<li><p><em>redundant_work</em>. Percentage indicating concurrent discovery calculated by: <code>[(total edges we put into frontier - edge visited) / edge visited] * 100</code>.
Actual code:</p>

<p>// measure duplicate edges put through queue
    redundant_work = ((double)total_queued - edges_visited) / edges_visited;</p></li>
<li><p><em>total_queued</em>. Total elements put into the frontier.</p></li>
</ul>
<h2 id='bfs-specific-fields'>BFS-specific fields</h2>
<ul>
<li><em>impotence</em>: Set by command-line flag; true or false.</li>
<li><em>instrumented</em>: Set by command-line flag; true or false.</li>
<li><em>iterations</em>. Not entirely sure what this indicates. Example: <code>10</code>.</li>
<li><em>max_grid_size</em>. Number of grids for GPU kernels, but sometimes the enactor itself will calculate a optimal number and ignore this setting.</li>
<li><em>max_queue_sizing</em>. Used to calculate the initial size of frontiers (#vertices * queue-sizing, or #edges * queue-sizing). --<em>in-sizing</em> is for similar purpose, but for those buffers used by GPU-GPU communication.</li>
<li><em>search_depth</em>. Presumably maximum distance from the source found in the graph. Integer.</li>
<li><em>traversal_mode</em>. Switch for <em>advance</em> kernels. 0: load-balanced partitioning (Davidson); 1: Merrill's load-balance strategy. Default is currently dynamically choosing between the two.</li>
<li><em>undirected</em>. Is the graph is undirected (true) or directed (false)? Command-line option.</li>
<li><em>vertex_id</em>. Starting vertex ID. Integer.</li>
</ul>
<h2 id='thread-safety-quot-using-json-spirit-with-multiple-threads-quot'>Thread safety: "Using JSON Spirit with Multiple Threads"</h2>
<p>"If you intend to use JSON Spirit in more than one thread, you will need to uncomment the following line near the top of json_spirit_reader.cpp.</p>

<p>"//#define BOOST_SPIRIT_THREADSAFE"</p>

<p>"In this case, Boost Spirit will require you to link against Boost Threads."</p>

<p><a href="http://www.codeproject.com/KB/recipes/JSON_Spirit.aspx#threads">link</a></p>
<h2 id='if-compilation-is-too-slow'>If compilation is too slow</h2>
<p>Currently we're using the header-only version of JSON Spirit, which is easier to integrate but requires more compilation. The (docs)[http://www.codeproject.com/KB/recipes/JSON_Spirit.aspx#reduc] have ways to increase compilation speed.</p>
<h1 id='setup-and-use-gunrock-io'>Setup and Use gunrock/io</h1>
<p>gunrock/io can be used to generate visual representation of graph engine performance, for exmaple, Gunrock.
It takes output of a graph algorithm run and can produce visual output in svg, pdf, png, html and md format.</p>

<p><strong>Grunrock/io Dependencies</strong></p>

<p>To use gunrock/io to produce visual output of any graph algorithm, (as of Dec.2016), below are dependencies overview:</p>

<ul>
<li>python 2.7.6</li>
<li>gcc 4.8.4</li>
<li>nodejs/node</li>
<li>npm</li>
<li>pandas 0.19.2</li>
<li>numpy 1.11.3</li>
<li>altair 1.2.0</li>
<li>vega 2.6.3</li>
<li>vega-lite 1.3.1</li>
<li>inkscape 0.91</li>
</ul>

<p>Below are the instructions to to install dependencies,</p>

<p><strong>Assume the machine has the following env setup:</strong></p>

<ul>
<li>OS: Ubuntu 14.04</li>
<li>Python 2.7.x</li>
<li>GCC 4.8.x</li>
</ul>

<p><strong>Nodejs and Npm</strong></p>

<p>First check if node and npm have been installed:</p>

<p>On command line type:
    node -v
    npm -v
If there is node and npm version output, move on to install altair</p>

<p>Install nodejs and npm on root:</p>

<p>sudo apt-get install libcairo2-dev libjpeg8-dev libpango1.0-dev libgif-dev build-essential g++
    sudo apt-get install nodejs
    sudo apt-get install npm
    #Create a symbolic link for node, as many Node.js tools use this name to execute.
    sudo ln -s /usr/bin/nodejs /usr/bin/node</p>

<p><strong>Install altair</strong></p>

<p>sudo pip install altair</p>

<p>If no root access, use following command:</p>

<p>pip install --user altair
    vim ~/.bashrc
    HOME=/home/user
    PYTHONPATH=$HOME/.local/lib/python2.7/site-packages
    source ~/.bashrc</p>

<p><strong>More altair depencies to save figures</strong></p>

<p>npm install -g vega@2.6.3 vega-lite
    #"-g" option install npm/node_modules in /usr/local/bin
    npm -g bin
    #returns directory of installed binary files
    ls [returned directory]
    #check if {vg2png  vg2svg  vl2png  vl2svg  vl2vg} exist in [returned directory]</p>

<p>If no root access, use following command:</p>

<p>npm install vega@2.6.3 vega-lite
    npm bin
    ls [returned directory]
    #npm install /node_modules in current directory
    #check if {vg2png  vg2svg  vl2png  vl2svg  vl2vg} exist in /bin or /.bin
    #Open .bashrc add:
    NPM_PACKAGES=/where/node_modules/folder/is/
    PATH=$NPM_PACKAGES/.bin:$PATH
    source ~/.bashrc</p>

<p><strong>More dependencies to save figure as pdf: inkscape</strong></p>

<p>sudo add-apt-repository ppa:inkscape.dev/stable
    sudo apt-get update
    sudo apt-get install inkscape</p>
<h2 id='how-to-use-gunrock-io'>How to use gunrock/io</h2>
<p>With all the dependencies installed, to use gunrock/io, below is a guide of how to reproduce the performance figures from JSON in gunrock/io:</p>

<ol>
<li><p>Parses the engine outputs (in txt format) and generates jsons containing important information regarding the output results using <strong>text2json.py</strong>. (Instructions @ <a href="https://github.com/gunrock/io/blob/master/scripts/README.md">README</a>)</p></li>
<li><p>Make a folder for output visual representation files.</p></li>
<li><p>One can use exsiting scripts to generate different visualization output from JSON files. For example, altair_engines.py generates performance comparison visualization from different graph engines. Below is an example makefile to generate different engines performance comparison figures into .md file into gunrock/doc:</p></li>
</ol>
<pre class="highlight plaintext"><code>    ENGINES_OUTPUTS = output/engines_topc.md \
    output/engines_topc_table_html.md
    PLOTTING_FILES = fileops.py filters.py logic.py
    DEST = "../../gunrock/doc/stats"
    ALL = $(ENGINES_OUTPUTS) \
    all: $(ALL)
    $(ENGINES_OUTPUTS): altair_engines.py $(PLOTTING_FILES)
            ./altair_engines.py
    install: $(ALL)
            cp $(ALL) $(DEST)
    clean:
            rm $(ALL)
</code></pre>
<p>After running these commands, output .md files will be copied into gunrock/doc/stats, in the output directory made in step 2, there will also be .html, .svg, .png, .pdf, .eps and .json output files generated. To start a new python scripts that will output other visualization output, please follow (script @ <a href="https://github.com/gunrock/io/scripts/altair_engines.py">altair_engines.py</a>).</p>

<p>Reference:</p>

<ul>
<li>https://altair-viz.github.io/documentation/displaying.html</li>
<li>http://wiki.inkscape.org/wiki/index.php/Installing_Inkscape</li>
<li>https://altair-viz.github.io/installation.html</li>
<li>http://www.hostingadvice.com/how-to/install-nodejs-ubuntu-14-04/</li>
</ul>

      </div>

      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
